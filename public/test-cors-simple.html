<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick CORS Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .test-box {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            opacity: 0.9;
        }

        pre {
            background: #2d3748;
            color: #68d391;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin-top: 15px;
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            display: none;
        }

        .result.success {
            background: #d4edda;
            color: #155724;
            display: block;
        }

        .result.error {
            background: #f8d7da;
            color: #721c24;
            display: block;
        }

        .info {
            background: #e7f3ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>

<body>
    <div class="test-box">
        <h1>üß™ Quick CORS Test</h1>
        <p>Test CORS dari localhost ke backend ngrok</p>

        <div class="info">
            <strong>Backend URL:</strong> <code id="backend-url">https://47dcecf43226.ngrok-free.app</code><br>
            <strong>Testing from:</strong> <code id="origin">http://localhost:8002</code>
        </div>

        <button onclick="testSimple()">üöÄ Test Simple POST</button>
        <button onclick="testPreflight()">‚úàÔ∏è Test Preflight (OPTIONS)</button>
        <button onclick="copyTestCode()">üìã Copy Test Code</button>

        <div id="result" class="result"></div>

        <pre id="code-snippet" style="display:none;">
fetch('https://47dcecf43226.ngrok-free.app/api/login', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    username: 'test',
    password: 'test'
  })
})
.then(res => {
  console.log('Status:', res.status);
  console.log('CORS Headers:');
  console.log('Access-Control-Allow-Origin:', res.headers.get('Access-Control-Allow-Origin'));
  console.log('Access-Control-Allow-Credentials:', res.headers.get('Access-Control-Allow-Credentials'));
  return res.json();
})
.then(data => console.log('Response:', data))
.catch(err => console.error('Error:', err));
        </pre>
    </div>

    <script>
        const BACKEND_URL = 'https://47dcecf43226.ngrok-free.app';

        document.getElementById('origin').textContent = window.location.origin;

        async function testSimple() {
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result';
            resultDiv.innerHTML = '‚è≥ Testing...';
            resultDiv.classList.add('success');

            try {
                const response = await fetch(BACKEND_URL + '/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: 'test',
                        password: 'test'
                    })
                });

                const origin = response.headers.get('Access-Control-Allow-Origin');
                const credentials = response.headers.get('Access-Control-Allow-Credentials');
                const data = await response.json();

                if (origin) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <strong>‚úÖ CORS WORKS!</strong><br><br>
                        <strong>Status:</strong> ${response.status}<br>
                        <strong>Access-Control-Allow-Origin:</strong> ${origin}<br>
                        <strong>Access-Control-Allow-Credentials:</strong> ${credentials}<br>
                        <strong>Response:</strong><br>
                        <pre style="margin-top:10px;">${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `
                        <strong>‚ùå CORS NOT WORKING</strong><br><br>
                        No Access-Control-Allow-Origin header found!<br>
                        Make sure you restarted Laravel server after config change.
                    `;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <strong>‚ùå CORS ERROR</strong><br><br>
                    ${error.message}<br><br>
                    <strong>Common causes:</strong><br>
                    ‚Ä¢ CORS not configured properly<br>
                    ‚Ä¢ Laravel server not restarted<br>
                    ‚Ä¢ Ngrok warning page blocking request<br>
                    ‚Ä¢ Backend server offline
                `;
            }
        }

        async function testPreflight() {
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result';
            resultDiv.innerHTML = '‚è≥ Testing preflight...';
            resultDiv.classList.add('success');

            try {
                const response = await fetch(BACKEND_URL + '/api/login', {
                    method: 'OPTIONS',
                    headers: {
                        'Access-Control-Request-Method': 'POST',
                        'Access-Control-Request-Headers': 'Content-Type,Authorization',
                    }
                });

                const origin = response.headers.get('Access-Control-Allow-Origin');
                const methods = response.headers.get('Access-Control-Allow-Methods');
                const headers = response.headers.get('Access-Control-Allow-Headers');

                if (origin) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <strong>‚úÖ PREFLIGHT PASSED!</strong><br><br>
                        <strong>Status:</strong> ${response.status}<br>
                        <strong>Access-Control-Allow-Origin:</strong> ${origin}<br>
                        <strong>Access-Control-Allow-Methods:</strong> ${methods}<br>
                        <strong>Access-Control-Allow-Headers:</strong> ${headers}
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `
                        <strong>‚ùå PREFLIGHT FAILED</strong><br><br>
                        No Access-Control-Allow-Origin header found in OPTIONS response!
                    `;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <strong>‚ùå PREFLIGHT ERROR</strong><br><br>
                    ${error.message}
                `;
            }
        }

        function copyTestCode() {
            const code = document.getElementById('code-snippet').textContent;
            navigator.clipboard.writeText(code.trim());

            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result success';
            resultDiv.innerHTML = '‚úÖ Test code copied to clipboard! Paste in browser console.';

            setTimeout(() => {
                resultDiv.className = 'result';
            }, 3000);
        }
    </script>
</body>

</html>